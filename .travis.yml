language: java
env:
  global:
    - PATH=$HOME/.local/bin:$PATH
    - secure: k8TAhQ8AT1vqgIBRzNgR+f6Li4FTml9o7azcYFRhicep8ohx1WquXr5JGcyXXc1esrv/h3dgCyNLZjXd7oM3VcNUp0Z0DqI2LfRQ4dX93L8wky5ZOQNzThnnn2iDgRBtrc6zeaGY15gwei30bgiglKLJcewugzp7BVVF5E1ZQiOqZykkAYuk5OyXUTSG6sngcOIXuT3vc5ndXNLFv44ySDyQc+aWzFvAVOfD+MA/4ffhktLQEgs8jmS8ghnrVZuKI0RbfT9fYmq/4dWK+AjHPYUf6Z0wbqN/x63k+tkvxx7kRuch8aGz5r04CfhUP6chnaq4toegygAaABRUr6Mo1WRmV4avfqZFRR+C6zU1aRi1CpTSEpxghX8xmuMU1uq3KkWK15+yu9IvTYpfE4A8PqWRSS9dfK/faEGT7NatIfh0Z1clZ7CdZkspFyo3ZpfohlaBhgQoMX7EBKC+AgJraDa5SEzDIsYeNMXLm1wBQAyf8lt6wyrBXRuaRGPWsWMxWOqok2a7IMeoiHMdF8rFIXcGZxqL4VCyV7aIk6yR7JlGAVe3Td9pwkGt4ezFS27KqAGO1ZKnj8yvlb1UCY1S/mdkd8xv5SZ5vqnYAJ1AiQ4aMbsS5W37bmaOxloBZmKqy89j363rPP+8UyLfx6LTmu1k9FaC5vW9ZGN9YuAnyWc=
    - secure: Z9Vx1jBYydfxzOmwLSfEZKSRwfXhg3rRcs0opmJ1LvCNXvwzlgJUW9/Y7paH3Aevo7/7a719W+9SDG9CDHnVP7+BCwFaTF8YG3LW0lcaRy8aQ6ONlnFfQaDYiv9yfHwVgcYcINSpMpyc9sXO1y/mx0EA9KqvRMql9HCjFwBrGotzw1VdeCAqpoZGhADfmcCJkxb7gn0Jzw5tzRIZ1MVFJEdMxv3FTPcawFfOWYxz6s1NIN4v86tGDMNezVjHzrRff0u5QNdpc8/Clgn8D1lzTKJPo9s8C7u1H9W9CflsNG4ZaCTYw9cMYvzgBeR/2UxFl5UMg/ppYlGMBzLSiGF0kjQCBwXuUSkpYdaZvxthkiNvN5mxRtKTeDKX8FsMzpxmpS3V2PrlUedTaZ4RHSNhwxPGk1huxISJhflU+D4lcoBvuLI/H/H0z1bTrBrF2b0yFJc61OUtSFydoMIjfr+NZ30w21xj5Ot2XQk/l+zejmFBlMUrm2TRf1nvaM1dRSrqABv8bHKe3yHBJaC37dlZPBlLNVaOlnrvK7zizgu8yWBhwwPkLwBQy+cEwPqWavsJtHJpH3mIH66ypzPX4003YXU2MLh9X1cBk3siKdvvzF81Lfy/lHSWhvnwjEjVZOyiUhj3gPUyZ+uBsGCqVRms+YXt9qd6C82cp31i+3KPXoA=
    - secure: jvX/Rt3PA1Rg3UoDAJdvI9C0dIe13C4JIImklvjzk7//heOdLmK+ETccKKSKSBQwzlTbn+vu5mY8HYGDyJ06sS04Yjw5nVtKuE+i05qzAvh8YYSC+Yx6Hv5ObWlOVZrcpqH7iSVT4CvebnojU/gx6PbCrOzQwGkF81eekEWrt2DJuEInZnS3idgdrTJvCKf3xOFn9M2w2ccpT1XRrmW7Bj+PXvg1Yn5eaBVXCx8LJwW7J3zVGiNqH1Cq8dPjQBgHFgTpd0NRzobSzOd7whQSjvDJjJWksucpQRCHfhARBVR7mA6CuzOZwCYEVbA8URzTc14jbGtCyUZkIFBsu8eSz8PccGJaChy+AdDnFR6e9Sw0ed88IyD4R/imwSj4MEjbdbxKCvKFWAWUPz+p8IdOCnyjP6adrZ/5l1Muz65JvGdnRCL2KH/uUZEMvIrWxm/6hkcTfhmrhaBwEMH/RIv2FQcTzWLeSAbaMu4tOyk75xjJzM3rzMiJ48QhQPckroOAYO5yMpzmW8cPIrb51egRQbRi058YRSYoyFqsa5BXme3x1DbsRy4Zaml39Xv7N5v1CPlQsr5qG/dKlhwOASMXzeFTGUwHGgaCA8+HYYtQmT3Kr9ugxC713gSdlgQreqEe++G+0y1lPWF0CAaPFAJeiqqHpxBK1QoLgXvTittc3sc=
    - secure: Ia80pY1MKssIbvMgNbvTqKTYg04Yh4hs0oACT8Kf4NpTPq47wOkYXizGCVgPeCaaYCx8LHH5Mh5n109KnmVZE3th1m24VOIBGCLhrfRjP/ZU9smL71ngWL0gAZeNd0bTlviGczVpGL8nCCt7CAxO1nrAgjyD0RUE1okXECwX0KIYoi8q1RcQbFO0xBhX8ryFj+ahziFPbsMBO5deIOEjQI5bHDWUqgstQGa7tAi1QNBYNuQbzaZQ6Kyj57mjqUvIa+XDX0mzCk6gfNV5S4QGwhvRBnLyfi1zT7S4bVdlBk+E2xsZ1OHccF7XPzQgpa7ZwT5NpDou6Ut1Gnnf8NU3WuxCVZ9YPlKQA6+0q3w62WAxk35IXqF+s+DUC2CNil+ruV05AdeSivVX6vtwonZTEYp0UNpeqWJ85oCq507YN+NorxcIgpGVyoFjAsGXHV2Rrp/b+QWp3Pdde4sBYtYRxx06+paRKoffHW/WRpNlbRgM3ze4i14BQLB4rNgtN40Poh6pKs4yDm4LXu+IVFiCfB0rKZy3lvNcz2rRzkWGgYfOsuvGg+5R+z5qMqwUJxhX6a7pnEyR3KeFkKL+m2ypGmiEbWlO1dcfU/T7TNp8W9HAcOxlh2J+AV5jUFmyWNkv4abJHi3vGzo+alg19jWNoLzEHoPdknTpUfgYnkVyY3I=
    - secure: S50qaKJYecIcawKY/8ZT3r/lsrWTcWdBq/dL7b6q5/AM+uac8obawvhtW2vfc6lw2Ubghqe3xxt+V7dercTpX4EYHNUJhe57kWtnvdSVDMJekEnhj5p0MehuCp1yeyoQ8jH9+vSxJ0mh+wEuO2arzeW32oqFN0/b7fz/7+nB/qnw8vBheY0FLNBr60f6tUkLoItLqAFLyXdUkKz2m8g2cgOQgTZ9o9340ITS/0syq/pTT7sjmy+eIm25CZD0Ajhw5fnbP5KTuvTmrXfxRS54P1K0MVSCkvUTRo6gei+swZA3StTTpbPyBp9Ub1N5ZbWUz1v//VDPOBV5YlbKWLIa255ffBHBS+V+l+ZbwD9UCXkbILbC/eVsC2jp43c1IxtJS5x3giFbF7kupCjrnstWyTaTAk+WkHkEah6m8vCLdUt82DdDtg5Q7ufNohAVlGPbfOTb16RSKq2G5OfLN0KIgfMFxqAs24fvjncpRShGvNtYme7SMF8kiShheSti3JOfzLegKzYSaL8lFJB0B+jU8tZl+iiH/mGYKpnz4I4/Es0Tqh6NjqWHcgHO8nU8snOsW5ynYcTUl+6MrVN9BXUI+5hAEd2mKEZz4pbNG2B1160vpa3YmKT9pXar7qb1cWYNLTNB0YbWe6PjGNqQSNZIhWOw48HBTJX9Ek+BBjG7Idw=
    - secure: OJz7ziMNvzP4+rgahDDqXh9UIxWoErAqOgNRZDqP8eKL2jy7QKfgy2I8xc3u0ZmU56wG90PkcjqQAUSAdI8rWbDWeauMyLXP/fDSMGRzVC1QpiTRNuOy1GHSDqXLbKxGkijdYDgopuY3Q5o4fdsozfCgUCK7uEc3NGFoMVjfwPUffr7rc65hsSP8zz6RFIrhAdQcw6/oinBnfVpdtIZcBerxMP7sXYEWHM3dkWoMLXxH9/HvgZqu1sB2jjw7E9Gk+Af+FycvDzPfsNMNM0RrbzWCkfAo/KRl7sjNFMjieZfU4HJ8rw/aBri2vGAF0zJ5pnsUbv9Y9lZltG6FDxx2XovW8ApDYPrpW9g8PnG1bpXiagQQymHwfwoZ45XgogMJXp34lDk8wkIXONOrYsIqILBYS21rhaD8KqFhsXG1RWDk1iaK6zuU5jQy/X/VAr4qSvPQ/rxTk7Wu0Ei6UsCY4E2HK8geb8vl+b95PeXrln0D9R/spjJiCjySDnRMGl/amIZCJOQZWZxsygQoAY7JRcB7tHkh84NeUKaNGWdUlS92nbcr2KPF/I7a7hRb6ch5fGFqkj13j6O5gl/anBByOpJh5FGuFHsFsmz15enD45CZl7aGaTyN+AG+mJQB81BaeH3pnI5GScN1UR9S6kAGf2pKFDJiL0YWyYEvK2S+l8g=
jdk:
  - openjdk11
services:
  - docker
addons:
  sonarcloud:
    organization: delegacy-github
    token:
      secure: eMXBgzmGwoYXnACqX3noOG2HvMOU9DdlWloOnTjP7VfUoLtxI199tVDfmL4oZm86qHQ6pqaLL7mYea4fHZ9oeI6MACwTgPKLZx3En3ERslYZQZ96dkJYT77itnFeGHQFs73CJ9rsTGFwgX+2i/SMyL8urmAekDN1/H3BL4KoCTo7ouMIgOrEnb13IJqwnEAN1FZffHk9cUXrOxRHdxRgTFXv7XYJq+PFxMaMP9mxbpxhi6qfr11taLnPccZHzijKap8E0m3Y8viHnOf1TZb2ftuT7oocO6O+Wqcq5Fmv2fjwBnE4V/4h81RT5Lo09m0V+UTgf50Hv3zx8mE1ketYBE6p1pawQEjOyd3RZH8h1t0vyH6NfYbKmbTfPb5hDJikiUpuzRPv86ksKi9eObgFZjmD3QaEsV4UdOKZjOm7nvtUD55lQUZE4CBOVc4+SCaYlzHkOCM2520Ps/JpHhj0weNBXt6nOy29DiJiLxb+QwI2cv77sQL1asFlA8/gJtitTuGcon2Fm8ucJF9XDHf/tdMJ2pntD4e2ytiEZ6DWsQdNWiOVw4bkpOW93Ete2AwKlWXuyV0Hv05HP9QTA7yFZAOhKvPzPdHNIGJjE42O9m2qtBmmrNsrsnyrr8Gz9pcWVJdqYFCWybMw4i1KCdE7oNDh1bx2Pbszf/EL6tbZbGw=
branches:
  only:
    - master
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
    - "$HOME/.m2/repository"
    - "$HOME/.sonar/cache"
    - ".gradle"
script:
  - "./gradlew check sonarqube codeCoverageReport"
after_success:
  - bash <(curl -s https://codecov.io/bash)
before_deploy:
  - pip install --user awscli
deploy:
  skip_cleanup: true
  provider: script
  script: "./gradlew build dockerBuildImage dockerPushImage -x test && ./deploy/ecs-deploy.sh"
  on:
    branch: master
